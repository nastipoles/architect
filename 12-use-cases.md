# USE CASE 1: «Регистрация и онбординг нового пользователя»

**Цель:**  
Создать учетную запись, начать пользование приложением, выбрать базовые интересы.

**Акторы:**
- **Пользователь (гость):** человек, который впервые скачал приложение или открыл веб-версию.
- **User & Identity Service (система):** осуществляет регистрацию, хранение профиля.
- **Email/Push провайдер:** отправка кода подтверждения (если требуется).

**Предусловия:**
- Приложение установлено (или открыт сайт).
- У пользователя есть доступ к сети Интернет.

**Основной поток:**
1. Пользователь открывает приложение и выбирает «Создать новый аккаунт».
2. Система предлагает варианты регистрации (email/пароль, соцсети, SSO).
3. Пользователь вводит email и пароль (либо подтверждает вход через соцсеть).
4. Приложение отправляет запрос в User & Identity Service на создание учетной записи.
5. При необходимости система может выслать код подтверждения (email/SMS) и запросить ввод этого кода.
6. После успешного создания аккаунта система предлагает «Онбординг»:
   - Выбрать основные виды спорта (бег, йога, фитнес и т.д.).
   - Указать цели (похудеть, нарастить выносливость, etc.).
7. Система сохраняет введенную информацию в профиле пользователя.
8. Пользователь видит приветственный экран с предложением начать тренировку, присоединиться к группам, посмотреть ленту.

**Альтернативные потоки:**
- **A1:** Ошибка при вводе email/пароля (короткий пароль, некорректный email) → система показывает сообщение об ошибке, просит исправить.
- **A2:** У пользователя уже есть аккаунт, но он пытается создать новый с тем же email → система предлагает «восстановить пароль».
- **A3:** Код подтверждения не введен или введен неверно → повторная отправка/проверка кода.

**Результат:**
- Создана учетная запись, пользователь авторизован.
- Система знает его базовые интересы (виды спорта, цель).

**Критерии успеха:**
- Пользователь может войти повторно под указанными учетными данными, его данные сохранены.
- Примерная метрика: % успешных регистраций среди начавших (конверсия).

---

# USE CASE 2: «Запись и завершение тренировки»

**Цель:**  
Позволить пользователю зафиксировать свою физическую активность (бег, вело, йога и т.д.) и получить основную статистику.

**Акторы:**
- **Зарегистрированный пользователь (спортсмен):** инициирует тренировку.
- **Workout & Analytics Service:** обрабатывает данные, сохраняет их, выдает статистику.
- **Фитнес-устройство (необязательно):** смарт-часы, пульсометр.

**Предусловия:**
- Пользователь авторизован в приложении.
- Если используется внешнее устройство, оно подключено (BLE/ANT+/API).

**Основной поток:**
1. Пользователь выбирает «Начать тренировку» в приложении (или на устройстве).
2. (Опционально) Приложение устанавливает связь с устройством, получает параметры (пульс, GPS и т.д.).
3. Система (Workout & Analytics) начинает фиксировать данные (время старта, текущие показания).
4. По завершении пользователь нажимает «Остановить тренировку» (или на устройстве).
5. Приложение отправляет финальные данные (дистанция, время, калории) в Workout & Analytics Service.
6. Сервис рассчитывает итоговую статистику (средний темп, суммарное время, графики пульса).
7. Система показывает пользователю результат (в приложении).
8. В фоне публикуется событие `workout.completed` в брокер сообщений (если нужно геймификация, соц. лента).

**Альтернативные потоки:**
- **A1:** Потеря соединения с устройством → приложение может предложить ручной ввод данных (примерно время, дистанция).
- **A2:** Прерывание тренировки раньше срока (травма, плохое самочувствие) → система фиксирует фактические данные до момента прерывания.
- **A3:** Пользователь случайно нажал «Начать» или «Остановить» → возможность отменить запись или отредактировать.

**Результат:**
- Сохранена запись о тренировке с подробной статистикой.
- Пользователь видит итог (например, в ленте своих тренировок).

**Критерии успеха:**
- Тренировка корректно сохраняется, данные не теряются.
- Пользователь может просмотреть историю и аналитику.

---

# USE CASE 3: «Покупка спортивного инвентаря (E-commerce интеграция)»

**Цель:**  
Приложение рекомендовало товар, пользователь совершает покупку (обувь, экипировка).

**Акторы:**
- **Зарегистрированный пользователь (покупатель).**
- **E-Commerce Adapter:** соединяет новое приложение и существующий магазин.
- **Payment Gateway:** платежная система.

**Предусловия:**
- Пользователь авторизован.
- Товар доступен (приложение показывает актуальный статус, цену).

**Основной поток:**
1. Пользователь видит рекомендацию «Пора обновить кроссовки», нажимает «Купить».
2. Приложение вызывает E-Commerce Adapter с параметрами товара и ID пользователя.
3. Адаптер проверяет наличие, формирует «предзаказ» в системе магазина.
4. Пользователь переходит к оплате (может быть встраивание оплаты в приложение или переход на страницу платежа).
5. Пользователь вводит платежные данные (или использует сохраненную карту).
6. Успешная оплата → Payment Gateway отправляет подтверждение в E-Commerce Adapter.
7. Адаптер обновляет заказ до статуса «Оплачен» и отправляет событие `order.completed` в message bus.
8. Приложение показывает «Спасибо за покупку», пользователь может отследить заказ.

**Альтернативные потоки:**
- **A1:** Недостаточно средств или отказ платежа → пользователь видит сообщение «Оплата не прошла», может повторить или выбрать другой способ.
- **A2:** Товар закончился на складе → адаптер вернет ошибку, приложение предложит альтернативы.
- **A3:** Сбой связи с магазином → повторная попытка или отмена заказа.

**Результат:**
- Заказ создан и оплачен в системе e-commerce, пользователь получил подтверждение.
- Уведомление (push/email) или запись в соц. ленте («Пользователь обновил свою экипировку»).

**Критерии успеха:**
- Увеличение конверсии в покупку.
- Минимальное количество отказов из-за технических ошибок.

---

# USE CASE 4: «Участие в массовом челлендже/соревновании»

**Цель:**  
Организатор (компания или партнер) создает челлендж (например, «Пробежать 50 км за неделю»), а пользователи массово регистрируются и пытаются выполнить цель.

**Акторы:**
- **Организатор (администратор или партнер):** создает событие.
- **Зарегистрированные пользователи (участники):** присоединяются к челленджу.
- **Social & Gamification Service:** ведет учет прогресса, лидерборды.

**Предусловия:**
- Челлендж объявлен (есть название, даты, правила).
- Пользователи видят анонс в приложении или через рассылку.

**Основной поток:**
1. Организатор формирует челлендж (название, сроки, цель — 50 км, награды).
2. Система (Social & Gamification) сохраняет данные о челлендже.
3. Пользователи просматривают список доступных челленджей, нажимают «Принять участие».
4. Во время челленджа каждая тренировка автоматически учитывается (см. USE CASE 2).
5. Система обновляет прогресс пользователя и лидерборд.
6. По истечении срока челленджа рассчитываются итоги (кто выполнил, кто лидер).
7. Победители получают награды (бейджи, промокоды), все участники — уведомление о завершении.

**Альтернативные потоки:**
- **A1:** Пользователь пытается присоединиться поздно (после окончания или после лимита участников) → система отказывает.
- **A2:** Сбой в подсчетах (пиковая нагрузка) → система временно задерживает обновление лидерборда, показывает «Обновление будет через N минут».
- **A3:** Пользователь выходит из челленджа до окончания → прогресс больше не учитывается, пользователь в рейтинге не участвует.

**Результат:**
- Соревнование успешно проведено, участники увидели свои результаты, лидеры получили призы.
- Сообщество вовлекается, растут метрики активности.

**Критерии успеха:**
- Количество участников, стабильная работа приложения при пиках.
- Позитивные отзывы, рост вовлеченности (повышение DAU/MAU).

---

# USE CASE 5: «Персональные рекомендации (тренировки и товары)»

**Цель:**  
На основе данных о пользователе (история тренировок, интересы, покупки) система формирует рекомендации: планы тренировок, подбор экипировки.

**Акторы:**
- **Зарегистрированный пользователь (спортсмен).**
- **Recommendation & ML Engine:** сервис рекомендаций.
- **Workout & Analytics, E-Commerce Adapter:** источники данных.

**Предусловия:**
- У пользователя есть история тренировок, либо некоторые предпочтения в профиле.
- ML-модели обучены (Data Lake, исторические данные).

**Основной поток:**
1. Пользователь открывает раздел «Рекомендации», выбирает «Спланировать неделю тренировок» или «Подобрать экипировку».
2. Приложение передает данные пользователя (цель, история тренировок) в Recommendation & ML Engine.
3. Сервис анализирует и формирует набор предложений (например, план из 3 пробежек + 2 силовых тренировок на неделю).
4. Если речь об экипировке, сервис дает ссылки на товары (через E-Commerce Adapter).
5. Приложение отображает рекомендации пользователю.
6. Пользователь может «Принять» план или «Отклонить/Скорректировать».

**Альтернативные потоки:**
- **A1:** Недостаточно данных (новичок) → система предлагает общие планы (без сильно персонализированного подхода).
- **A2:** Пользователь оспаривает рекомендацию (слишком тяжелая нагрузка) → возможность вручную подредактировать.
- **A3:** Ошибка в работе ML Engine (нет соединения) → приложение дает базовые (статичные) советы.

**Результат:**
- Пользователь получает персональную программу тренировок или список подходящих товаров.
- Повышается лояльность и вероятность покупок.

**Критерии успеха:**
- Увеличение Retention (пользователь возвращается, чтобы следовать плану).
- Рост конверсии в покупку при товарных рекомендациях.
